---
layout: default
title: Faerûn Interactive Map
---

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

<style>
    /* Custom Map Styles */
    #map-container {
        position: relative;
        width: 100%;
        height: 80vh; /* Takes up 80% of the viewport height */
        border: 2px solid var(--color-border); /* Matches your site theme */
        box-shadow: var(--shadow-lg);
        border-radius: var(--border-radius);
        overflow: hidden;
    }

    #map {
        height: 100%;
        width: 100%;
        background: #1a1a1a; /* Dark background while loading */
        z-index: 1;
    }

    /* Customize Leaflet Popup to match your 'Fantasy' theme */
    .leaflet-popup-content-wrapper {
        background: var(--color-bg-card); /* Uses your theme variable */
        border: 1px solid var(--color-primary);
        border-radius: 4px;
        font-family: var(--font-header);
    }
    
    .leaflet-popup-content h3 {
        color: var(--color-primary);
        margin-bottom: 5px;
        border-bottom: 1px solid var(--color-border);
    }
    
    .leaflet-popup-content a {
        color: var(--color-secondary);
        font-weight: bold;
    }

    /* Fix for Leaflet z-index fighting with your header */
    .leaflet-top, .leaflet-bottom {
        z-index: 400; /* Lower than your site-header (z-index: 100) */
    }
</style>

<div class="doc-container">
    <div class="doc-title">
        <h1>Faerûn Interactive Map</h1>
    </div>
    
    <p>Explore the locations of the Forgotten Realms. Click on a pin to view more lore.</p>

    <div id="map-container">
        <div id="map"></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script type="module">
    // Import your Supabase client
    import { supabase } from './assets/js/supabaseClient.js';

    // Configuration for 4096x2918 Map
    const mapWidth = 4096;
    const mapHeight = 2918;
    const mapUrl = '/Guides/assets/images/faerun-map.png'; // Ensure this image exists!

    // Initialize Map
    const map = L.map('map', {
        crs: L.CRS.Simple,
        minZoom: -2,       
        maxZoom: 3,        
        zoomSnap: 0.5,
        scrollWheelZoom: true,
        attributionControl: false // Removes the generic "Leaflet" text
    });

    // Set Bounds
    const bounds = [[0, 0], [mapHeight, mapWidth]];
    L.imageOverlay(mapUrl, bounds).addTo(map);
    map.fitBounds(bounds);
    map.setMaxBounds(bounds);

    // --- FETCH PINS FUNCTION ---
    async function loadPins() {
        const { data: locations, error } = await supabase
            .from('locations')
            .select('*');

        if (error) {
            console.error('Error loading map pins:', error);
            return;
        }

        if (locations) {
            locations.forEach(loc => {
                // Leaflet Simple CRS uses [Y, X]
                const xy = [loc.y, loc.x];

                const marker = L.marker(xy).addTo(map);

                const popupContent = `
                    <div style="min-width: 150px;">
                        <h3>${loc.name}</h3>
                        <p>${loc.description || ''}</p>
                        ${loc.link_url ? `<a href="${loc.link_url}">Read Lore &raquo;</a>` : ''}
                    </div>
                `;

                marker.bindPopup(popupContent);
            });
        }
    }

    loadPins();

    // --- DEVELOPER TOOL: UNCOMMENT TO FIND COORDINATES ---
    /*
    const popup = L.popup();
    map.on('click', (e) => {
        popup
            .setLatLng(e.latlng)
            .setContent("X: " + e.latlng.lng.toFixed(0) + "<br>Y: " + e.latlng.lat.toFixed(0))
            .openOn(map);
        console.log(`INSERT INTO locations (name, x, y) VALUES ('New Place', ${e.latlng.lng.toFixed(0)}, ${e.latlng.lat.toFixed(0)});`);
    });
    */
</script>