---
layout: default
title: Monster View
permalink: /monster-compendium/view/
extra_css:
  - /assets/css/statblock.css
---

<div id="monster-viewer-container" style="max-width: 800px; margin: 0 auto; padding: 20px;">
    <div id="loading-state" style="text-align: center; font-style: italic; color: #666;">
        Loading monster details...
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="{{ '/assets/js/auth-manager.js' | relative_url }}"></script>
<script src="{{ '/assets/js/monster-calculator.js' | relative_url }}"></script>
<script src="{{ '/assets/js/monster-ui.js' | relative_url }}"></script>
<script src="{{ '/assets/js/monster-storage.js' | relative_url }}"></script>

<script>
document.addEventListener('DOMContentLoaded', async function() {
    const container = document.getElementById('monster-viewer-container');
    const params = new URLSearchParams(window.location.search);
    const monsterId = params.get('id');

    // 1. Validate ID
    if (!monsterId) {
        container.innerHTML = `
            <div class="error-message">
                <h3>⚠️ No Monster Selected</h3>
                <p>Please return to the <a href="{{ '/monster-compendium/' | relative_url }}">Compendium</a> and select a monster.</p>
            </div>`;
        return;
    }

    // 2. Initialize Auth (Required to get the Supabase Client)
    // We don't need a user to be logged in, but we need the client initialized
    if (!window.authManager) {
        container.innerHTML = "Error: Auth Manager not loaded.";
        return;
    }

    // 3. Fetch Monster Data
    // We use the storage module we created earlier
    const { data, error } = await MonsterStorage.getMonsterById(monsterId);

    if (error || !data) {
        console.error(error);
        container.innerHTML = `
            <div class="error-message">
                <h3>❌ Monster Not Found</h3>
                <p>This monster may have been deleted or does not exist.</p>
                <p><a href="{{ '/monster-compendium/' | relative_url }}">Return to Compendium</a></p>
            </div>`;
        return;
    }

    // 4. Render the Visual Statblock
    try {
        const state = data.content;
        
        // Update Page Title
        document.title = `${state.title} | Hawthorne Monster Compendium`;

        // Calculate Modifiers (Required for rendering)
        const abilities = MonsterCalculator.calculateAllAbilities(state);

        // Render HTML
        // Note: renderVisualStatBlock returns just the statblock HTML without the editor warnings
        const statBlockHtml = MonsterUI.renderVisualStatBlock(state, abilities);

        // Inject into page
        // We wrap it in a div to ensure the statblock CSS applies correctly
        container.innerHTML = `
            <div style="margin-bottom: 20px;">
                <a href="{{ '/monster-compendium/' | relative_url }}" style="text-decoration: none;">&larr; Back to Compendium</a>
            </div>
            ${statBlockHtml}
            
            <div style="margin-top: 40px; border-top: 1px solid #ccc; padding-top: 20px; font-size: 0.9em; color: #666;">
                <p><strong>Created by:</strong> ${MonsterUI.escapeHtml(state.creator)}</p>
                <p><strong>Version:</strong> ${data.version} (${data.status})</p>
                ${state.image_credit ? `<p><strong>Art Credit:</strong> ${MonsterUI.escapeHtml(state.image_credit)}</p>` : ''}
            </div>
        `;

    } catch (err) {
        console.error("Render Error:", err);
        container.innerHTML = `<div class="error">Error rendering monster: ${err.message}</div>`;
    }
});
</script>

<style>
/* Simple error styling */
.error-message {
    background: #fff1f0;
    border: 1px solid #ffa39e;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
}
</style>