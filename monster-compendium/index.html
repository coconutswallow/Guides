---
layout: default
title: Hawthorne Monster Compendium
background_image: /assets/images/fieldguide-back.png
extra_css:
  - /assets/css/statblock.css
---

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<h2>Hawthorne Monsters Compendium</h2>
<p>Community created monsters. Use the filters below to search.</p>

<div class="filter-container">
  <div class="filter-group">
    <label for="name-search">Name:</label>
    <input type="text" id="name-search" class="filter-input" placeholder="Search...">
  </div>
  <div class="filter-group">
    <label for="type-filter">Type:</label>
    <select id="type-filter" class="filter-select"><option value="">All Types</option></select>
  </div>
  <div class="filter-group">
    <label for="size-filter">Size:</label>
    <select id="size-filter" class="filter-select"><option value="">All Sizes</option></select>
  </div>
  <div class="filter-group">
    <label for="cr-from">CR Min:</label>
    <input type="number" id="cr-from" class="filter-input" step="0.125">
  </div>
  <div class="filter-group">
    <label for="cr-to">CR Max:</label>
    <input type="number" id="cr-to" class="filter-input" step="0.125">
  </div>
  <button id="reset-filters" class="reset-button">Reset</button>
</div>

<div id="monster-count" class="monster-count">Loading library...</div>

<div id="dynamic-monster-list"></div>

<script>
  // ðŸ”´ REPLACE WITH YOUR KEYS ðŸ”´
  const SUPABASE_URL = 'https://iepqxczcyvrxcbyeiscc.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImllcHF4Y3pjeXZyeGNieWVpc2NjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzNjU2MDEsImV4cCI6MjA3OTk0MTYwMX0.9fK4TppNy7IekO3n4Uwd37dbqMQ7KRhFkex_P_JSeVA'; 
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  document.addEventListener('DOMContentLoaded', async function() {
    const container = document.getElementById('dynamic-monster-list');
    const countLabel = document.getElementById('monster-count');

    try {
      // Fetch Approved Monsters
      const { data: monsters, error } = await supabase
        .from('monsters')
        .select('id, title, cr, type, data') 
        .eq('status', 'approved')
        .order('title');

      if (error) throw error;

      if (!monsters.length) {
        container.innerHTML = '<p>No monsters found.</p>';
        countLabel.textContent = '';
        return;
      }

      // Group by Category
      const grouped = monsters.reduce((acc, m) => {
        const cat = m.data.category || 'Uncategorized';
        if (!acc[cat]) acc[cat] = [];
        acc[cat].push(m);
        return acc;
      }, {});

      // Render
      let html = '';
      Object.keys(grouped).sort().forEach(cat => {
        const cards = grouped[cat].map(m => {
            const size = m.data.size || 'Medium';
            const img = m.data.image || ''; 
            const thumb = img ? `https://wsrv.nl/?url=${encodeURIComponent(img)}&w=80&h=80&output=webp` : '';
            
            return `
            <div class="monster-card" data-cr="${m.cr}" data-type="${m.type}" data-size="${size}">
              ${ img ? `<div class="monster-card-image"><img src="${thumb}" onerror="this.style.display='none'"></div>` : '' }
              <div class="monster-card-content">
                <h3><a href="/monster-compendium/monster-viewer.html?id=${m.id}">${m.title}</a></h3>
                <p class="monster-cr">CR ${m.cr}</p>
                <p class="monster-type">${m.type}</p>
              </div>
            </div>`;
        }).join('');

        html += `
          <div class="category-section">
            <h2 class="category-title">${cat}</h2>
            <div class="monster-list">${cards}</div>
          </div>`;
      });

      container.innerHTML = html;
      countLabel.textContent = `Showing ${monsters.length} monsters`;
      
      // (Optional: Re-attach your existing filter logic here)
      // Call initializeFilters() if you kept that function

    } catch (err) {
      console.error(err);
      container.innerHTML = '<p>Error loading monsters.</p>';
    }
  });
</script>

<style>
/* ... copy styles from your previous file ... */
</style>