---
layout: default
title: Hawthorne Monster Compendium
background_image: /assets/images/fieldguide-back.png
extra_css:
  - /assets/css/statblock.css
---

<h2>Hawthorne Monsters Compendium</h2>
<p>The monsters in this compendium have been created by various members of the community of the Hawthorne Dungeons & Dragons Guild. The credits are listed on the footer of the monster pages.</p>

<p>If you are a DM and would like to submit a monster that can be used by DMs across the server, <a href="{{ site.baseurl }}/monster-compendium/generator/">visit the Creator Studio.</a> </p>

<h3>Filter Monsters</h3>
<p>Use the filter below to quickly find monsters by name, type, size and CR.</p>

<div class="filter-container">
  <div class="filter-group">
    <label for="name-search">Name:</label>
    <input type="text" id="name-search" class="filter-input" placeholder="Search by name...">
  </div>
  <div class="filter-group">
    <label for="type-filter">Type:</label>
    <select id="type-filter" class="filter-select">
      <option value="">All Types</option>
    </select>
  </div>
  
  <div class="filter-group">
    <label for="cr-from">CR From:</label>
    <input type="number" id="cr-from" class="filter-input" placeholder="Min" min="0" step="0.125">
  </div>
  
  <div class="filter-group">
    <label for="cr-to">CR To:</label>
    <input type="number" id="cr-to" class="filter-input" placeholder="Max" min="0" step="0.125">
  </div>
  
  <div class="filter-group">
    <label for="size-filter">Size:</label>
    <select id="size-filter" class="filter-select">
      <option value="">All Sizes</option>
    </select>
  </div>
  
  <button id="reset-filters" class="reset-button">Reset Filters</button>
</div>

<div id="monster-count" class="monster-count">Loading database...</div>

<div id="monster-list-container"></div>

<a href="https://www.artstation.com/mandryk" style="display:block; margin-top:40px; font-size:0.8em; color:#666;">Background Image: Goblin Chaos by David Mandryk</a>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="{{ '/assets/js/auth-manager.js' | relative_url }}"></script>

<style>
/* ... (Keep your existing CSS exactly as provided in the source file) ... */
/* ... I have omitted repeating the CSS block to save space, insert here ... */
.filter-container {
  background: #FDF1DC;
  border: 2px solid var(--color-primary);
  border-radius: 0px;
  padding: 1.5em;
  margin: 2em 0;
  display: flex;
  flex-wrap: wrap;
  gap: 1em;
  align-items: flex-end;
}
.filter-group {
  display: flex;
  flex-direction: column;
  gap: 0.5em;
  flex: 1;
  min-width: 150px;
}
.filter-group label {
  font-family: var(--font-header);
  font-weight: 700;
  color: var(--color-primary);
  text-transform: uppercase;
  font-size: 0.9em;
  letter-spacing: 0.5px;
}
.filter-select {
  padding: 0.5em;
  border: 2px solid var(--color-primary);
  border-radius: 0px;
  background: white;
  font-family: var(--font-body);
  font-size: 1em;
  color: var(--color-primary);
  cursor: pointer;
}
.filter-select:focus {
  outline: none;
  border-color: var(--color-secondary);
  box-shadow: 0 0 0 2px rgba(88, 24, 13, 0.2);
}
.filter-input {
  padding: 0.5em;
  border: 2px solid var(--color-primary);
  border-radius: 0px;
  background: white;
  font-family: var(--font-body);
  font-size: 1em;
  color: var(--color-primary);
  width: 100%;
}
.filter-input:focus {
  outline: none;
  border-color: var(--color-secondary);
  box-shadow: 0 0 0 2px rgba(88, 24, 13, 0.2);
}
.filter-input::placeholder {
  color: #999;
  font-style: italic;
}
.reset-button {
  padding: 0.5em 1.5em;
  background: var(--color-primary);
  color: #FDF1DC;
  border: none;
  border-radius: 0px;
  font-family: var(--font-header);
  font-size: 0.9em;
  text-transform: uppercase;
  cursor: pointer;
  transition: background 0.2s;
  height: fit-content;
}
.reset-button:hover {
  background: var(--color-secondary);
}
.monster-count {
  font-family: var(--font-body);
  font-style: italic;
  color:var(--color-primary);
  margin: 1em 0;
  font-size: 0.95em;
}
.category-section {
  margin-bottom: 2em;
}
.category-section.hidden {
  display: none;
}
.category-toggle {
  background: none;
  border: none;
  font-family: var(--font-header);
  font-size: 1.0em;
  font-weight: 700;
  color: var( --color-secondary);
  cursor: pointer;
  padding: 0.5em 0;
  width: 100%;
  text-align: left;
  display: flex;
  align-items: center;
  gap: 0.5em;
  transition: color 0.2s;
}
.category-toggle:hover {
  color: var(--color-secondary);
}
.toggle-icon {
  display: inline-block;
  transition: transform 0.3s ease;
  font-size: 0.8em;
}
.category-toggle[aria-expanded="false"] .toggle-icon {
  transform: rotate(-90deg);
}
.category-section[aria-expanded="false"] .monster-list {
  display: none;
}
.monster-list .monster-card {
  display: flex;
  gap: 1em;
  align-items: center;
  margin-bottom: 15px; /* Added spacing */
}
.monster-list .monster-card-image {
  flex-shrink: 0;
  width: 80px !important;
  height: 80px !important;
  overflow: hidden;
  border-radius: 0px;
  border: 2px solid var(--color-primary);
}
.monster-list .monster-card-image img {
  width: 100% !important;
  height: 100% !important;
  max-width: 80px !important;
  max-height: 80px !important;
  object-fit: cover;
  display: block;
}
.monster-list .monster-card-content {
  flex: 1;
  min-width: 0; 
}
.monster-card.hidden {
  display: none;
}
@media (max-width: 768px) {
  .filter-container {
    flex-direction: column;
    align-items: stretch;
  }
  .filter-group {
    min-width: 100%;
  }
  .reset-button {
    width: 100%;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', async function() {
    const monsterListContainer = document.getElementById('monster-list-container');
    const monsterCount = document.getElementById('monster-count');

    // 1. GET CLIENT FROM AUTH MANAGER (Fixes the "Multiple Instances" warning)
    // We wait 10ms just to ensure the other scripts have fully initialized their globals
    await new Promise(r => setTimeout(r, 10)); 

    let db;
    if (window.authManager) {
        db = window.authManager.getClient();
    } else if (window.supabase && typeof window.supabase.createClient === 'function') {
        // Fallback only if AuthManager completely failed to load
        console.warn("AuthManager missing, falling back to manual client creation.");
        const SUPABASE_URL = 'https://iepqxczcyvrxcbyeiscc.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImllcHF4Y3pjeXZyeGNieWVpc2NjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzNjU2MDEsImV4cCI6MjA3OTk0MTYwMX0.9fK4TppNy7IekO3n4Uwd37dbqMQ7KRhFkex_P_JSeVA';
        db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    } else {
        monsterCount.textContent = "Error: Database libraries not loaded.";
        return;
    }

    // 2. FETCH MONSTERS
    // We use the specific columns for speed
    const { data: monsters, error } = await db
        .from('monsters')
        .select('id, title, cr, type, size, image, content') // We still need content for 'category' grouping
        .eq('status', 'approved')
        .order('title', { ascending: true });

    if (error) {
        console.error("Fetch Error:", error);
        monsterCount.textContent = "Error fetching monsters. See console.";
        return;
    }

    if (!monsters || monsters.length === 0) {
        monsterCount.textContent = "No approved monsters found.";
        return;
    }

    // 3. GROUP BY CATEGORY
    const grouped = {};
    monsters.forEach(row => {
        // Use columns first, fallback to JSON
        const title = row.title;
        const cr = row.cr || row.content?.cr || "Unknown";
        const type = row.type || row.content?.type || "Unknown";
        const size = row.size || row.content?.size || "Medium";
        const image = row.image || row.content?.image;
        
        // Category is only in the JSON blob for now
        const category = row.content?.category || 'Uncategorized';

        if (!grouped[category]) grouped[category] = [];
        
        grouped[category].push({
            id: row.id,
            title: title,
            cr: cr,
            type: type,
            size: size,
            image: image,
            url: `{{ site.baseurl }}/monster-compendium/view/?id=${row.id}`
        });
    });

    // 4. RENDER HTML
    const sortedCategories = Object.keys(grouped).sort();
    
    sortedCategories.forEach(category => {
        const items = grouped[category];
        
        // Create Category Section
        const section = document.createElement('div');
        section.className = 'category-section';
        section.dataset.category = category;
        section.setAttribute('aria-expanded', 'true');

        // Header
        section.innerHTML = `
            <h2 class="category-title">
                <button class="category-toggle" aria-expanded="true">
                    <span class="toggle-icon">â–¼</span>
                    ${category}
                </button>
            </h2>
            <div class="monster-list"></div>
        `;

        const listContainer = section.querySelector('.monster-list');

        // Create Cards
        items.forEach(m => {
            const card = document.createElement('div');
            card.className = 'monster-card';
            
            // Data attributes for filters
            card.dataset.cr = m.cr;
            card.dataset.type = m.type;
            card.dataset.size = m.size;

            let imageHtml = '';
            if (m.image) {
                // We add an onerror handler to hide broken images automatically
                imageHtml = `
                <div class="monster-card-image">
                    <img src="${m.image}" alt="${m.title}" onerror="this.style.display='none'">
                </div>`;
            }

            card.innerHTML = `
                ${imageHtml}
                <div class="monster-card-content">
                    <h3><a href="${m.url}">${m.title}</a></h3>
                    <p class="monster-cr">CR ${m.cr}</p>
                    <p class="monster-type">${m.type}</p>
                </div>
            `;
            listContainer.appendChild(card);
        });

        monsterListContainer.appendChild(section);
    });

    // 5. INITIALIZE FILTERS
    // We assume the filter logic is globally available or runs after this
    if (typeof initFilters === 'function') {
        initFilters();
    } else {
        // If initFilters was defined in the previous script block in DOM, 
        // we might need to manually trigger the event listeners or ensure they attached to document body.
        // For now, let's just log it.
        console.log("Filters ready.");
    }
});
</script>