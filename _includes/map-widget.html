<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<div id="{{ include.id | default: 'map-widget' }}" 
     data-map-component
     {% if include.name %}data-map-name="{{ include.name }}"{% endif %}
     {% if include.map_id %}data-map-id="{{ include.map_id }}"{% endif %}
     data-editable="{{ include.editable | default: 'false' }}"
     data-height="{{ include.height | default: '500px' }}">
</div>

<script type="module">
    import { initMapComponents } from "{{ '/assets/js/map-widget.js' | relative_url }}";
    
    // We wrap this in a check to ensure Leaflet (L) is ready
    function startWidget() {
        if (typeof L !== 'undefined') {
            initMapComponents();
        } else {
            console.log("Waiting for Leaflet...");
            setTimeout(startWidget, 50);
        }
    }
    
    startWidget();
</script>